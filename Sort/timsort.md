# ä¸–ç•Œä¸Šæœ€å¿«çš„æ’åºç®—æ³• Timsortï¼Œä½ æ¯æ¬¡è°ƒç”¨ `.sort()` æ–¹æ³•æ—¶éƒ½åœ¨ä½¿ç”¨å®ƒ

# è¿™ä¹ˆå¤šå¹´ç®—æ³•ç™½å­¦äº†ï¼ŒåŸæ¥æ¯æ¬¡æ’åºéƒ½åœ¨ä½¿ç”¨ä¸–ç•Œä¸Šæœ€å¿«çš„æ’åºç®—æ³• Timsort

åœ¨è®¡ç®—æœºç§‘å­¦çš„é¢†åŸŸï¼Œæ’åºç®—æ³•æ˜¯æ¯ä½å­¦ç”Ÿå¿…å­¦çš„åŸºç¡€ï¼Œè€Œæ’åºçš„éœ€æ±‚æ˜¯æ¯ä½ç¨‹åºå‘˜åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­éƒ½ä¼šé‡åˆ°çš„ã€‚

åœ¨ä½ è½»æ¾è°ƒç”¨ `.sort()` æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œæ’åºæ—¶ï¼Œæ˜¯å¦æ›¾å¥½å¥‡è¿‡ï¼Œè¿™ä¸ªç®€å•çš„æ–¹æ³•èƒŒåä½¿ç”¨çš„æ˜¯å“ªç§æ’åºç®—æ³•å‘¢ï¼Ÿ

æœ¬æ–‡å°†å¸¦ä½ èµ°è¿› TimSortï¼Œä¸€ä¸ªåœ¨æ ‡å‡†å‡½æ•°åº“ä¸­å¹¿æ³›ä½¿ç”¨çš„æ’åºç®—æ³•ã€‚

è¿™ä¸ªç®—æ³•ç”±å·¥ç¨‹å¸ˆ Tim Peters äº 2001 å¹´ä¸“ä¸º Python è®¾è®¡ï¼Œå¹¶è‡ª Python 2.3 ç‰ˆæœ¬èµ·æˆä¸ºå…¶é»˜è®¤æ’åºç®—æ³•ã€‚å®ƒçš„å½±å“ä¸æ­¢äºæ­¤ï¼ŒJavaã€Androidã€GNU Octaveã€Chrome çš„ V8 å¼•æ“ã€Swift ä»¥åŠ Rust ç­‰ä¹Ÿçº·çº·é‡‡ç”¨äº†è¿™ä¸€ç®—æ³•ã€‚

![Tim Peters](/doc/illustrations/timsort/Timsort01.jpg)

é‚£ä¹ˆï¼Œæ˜¯ä»€ä¹ˆè®© TimSort åœ¨ä¼—å¤šæ’åºç®—æ³•ä¸­ç‹¬æ ‘ä¸€å¸œï¼Œèµ¢å¾—äº†å¦‚æ­¤å¹¿æ³›çš„åº”ç”¨å’Œè®¤å¯å‘¢ï¼Ÿ

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥å‰–æ TimSort çš„å†…éƒ¨æœºåˆ¶ï¼Œæ­ç¤ºå…¶èƒŒåçš„é«˜æ•ˆå®ç°åŸç†ï¼Œè®©ä½ é¢†ç•¥è¿™ä¸€ç®—æ³•çš„ç‹¬ç‰¹é­…åŠ›ã€‚

## ğŸ§©å°è§„æ¨¡æ•°æ®çš„é«˜æ•ˆå¤„ç†ï¼šæ’å…¥æ’åº

Timsort æ˜¯ä¸€ä¸ªç»“åˆäº†æ’å…¥æ’åºå’Œå½’å¹¶æ’åºçš„æ··åˆæ’åºç®—æ³•ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†çœŸå®ä¸–ç•Œçš„å„ç§æ•°æ®ã€‚

ä»è¿™å¥å®šä¹‰ä¸­æ‚¨å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆ Timsort é€‰æ‹©äº†æ’å…¥æ’åºå’Œå½’å¹¶æ’åºï¼Ÿä¸ºä»€ä¹ˆè¯´å®ƒé€‚åˆå¤„ç†çœŸå®ä¸–ç•Œçš„æ•°æ®ï¼Ÿ

è®©æˆ‘ä»¬é¦–å…ˆæ¢è®¨ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ’å…¥æ’åºæˆä¸ºäº† Timsort çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚

å°½ç®¡æ’å…¥æ’åºçš„ç†è®ºæ—¶é—´å¤æ‚åº¦ä¸º `O(n^2)`ï¼Œçœ‹ä¼¼ä¸åŠ `O(nlogn)` çš„é«˜æ•ˆæ’åºç®—æ³•ï¼Œä½†æ’å…¥æ’åºçš„å®é™…æ•ˆç‡å´éå¸¸é«˜æ•ˆï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å°è§„æ¨¡æ•°æ®é›†æ—¶ã€‚

è¿™æ˜¯å› ä¸ºæ’å…¥æ’åºåªæ¶‰åŠä¸¤ä¸ªç®€å•æ“ä½œï¼š**æ¯”è¾ƒ**å’Œ**ç§»åŠ¨**ã€‚

é€šè¿‡æ¯”è¾ƒï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šæ–°å…ƒç´ çš„æ’å…¥ç‚¹ï¼›é€šè¿‡ç§»åŠ¨ï¼Œæˆ‘ä»¬ä¸ºæ–°å…ƒç´ çš„æ’å…¥è…¾å‡ºç©ºé—´ã€‚

![åŠ¨å›¾ æ’å…¥æ’åº](/doc/illustrations/timsort/Timsort02.gif)

å…³é”®åœ¨äºï¼Œ**å¯¹äºå°æ•°æ®é›†è€Œè¨€ï¼Œ`n^2` ä¸ `nlogn` çš„å·®å¼‚å¹¶ä¸æ˜¾è‘—ï¼Œå¤æ‚åº¦ä¸å ä¸»å¯¼ä½œç”¨ï¼Œæ­¤æ—¶æ¯è½®å•å…ƒçš„æ“ä½œæ•°é‡æ‰èµ·åˆ°å†³å®šæ€§å› ç´ ã€‚** å¾—ç›Šäºå…¶ç®€æ´çš„æ“ä½œï¼Œæ’å…¥æ’åºåœ¨å°è§„æ¨¡æ•°æ®é›†ä¸Šçš„è¡¨ç°é€šå¸¸éå¸¸å‡ºè‰²ã€‚

ä½†ç©¶ç«Ÿä»€ä¹ˆè§„æ¨¡çš„æ•°æ®é›†ç®—æ˜¯â€œå°â€å‘¢ï¼Ÿ

ä»¥ Python ä¸ºä¾‹ï¼Œå½“æ•°æ®é›†å¤§å°å°äº 64 æ—¶ï¼Œå®ƒä¼šé»˜è®¤é‡‡ç”¨æ’å…¥æ’åºã€‚è€Œåœ¨ Java ä¸­ï¼Œè¿™ä¸€ç•Œé™åˆ™è¢«è®¾å®šåœ¨äº†32ã€‚

## â—æ’å…¥æ’åºçš„ä¼˜åŒ–ï¼šäºŒåˆ†æ’å…¥æ’åº ##

å¯¹äº Timsort ç®—æ³•æ¥è¯´ï¼Œä¼ ç»Ÿæ’å…¥æ’åºä¹Ÿå­˜åœ¨è¿›ä¸€æ­¥æå‡æ€§èƒ½çš„ç©ºé—´ã€‚

å›é¡¾ä¸€ä¸‹ï¼Œæ’å…¥æ’åºæ¶‰åŠçš„å…³é”®æ“ä½œæœ‰ä¸¤ä¸ªï¼šæ¯”è¾ƒå’Œç§»åŠ¨ã€‚è¿™å…¶ä¸­ï¼Œå¯¹äºä¸€ä¸ªæ•°ç»„æ¥è¯´ï¼Œç§»åŠ¨çš„æ€»æ¬¡æ•°æ˜¯å›ºå®šä¸å˜çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»å‡å°‘æ¯”è¾ƒçš„æ¬¡æ•°æ¥ä¼˜åŒ–ã€‚

åœ¨æ’å…¥æ’åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¢«åˆ’åˆ†ä¸ºå·²æ’åºå’Œæœªæ’åºçš„ä¸¤ä¸ªéƒ¨åˆ†ã€‚åœ¨å·²æ’åºéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯»æ‰¾æœªæ’åºéƒ¨åˆ†ä¸‹ä¸€ä¸ªå…ƒç´ çš„æ’å…¥ä½ç½®æ—¶ï¼Œå¸¸è§„åšæ³•æ˜¯é‡‡ç”¨çº¿æ€§æŸ¥æ‰¾ã€‚

**ä½† Timsort é‡‡ç”¨äº†æ›´é«˜æ•ˆçš„ç­–ç•¥â€”â€”äºŒåˆ†æŸ¥æ‰¾æ³•ã€‚åˆ©ç”¨äºŒåˆ†æŸ¥æ‰¾åœ¨å·²æ’åºéƒ¨åˆ†å¯»æ‰¾æ’å…¥ç‚¹ï¼Œå¤§å¹…å‡å°‘äº†æ¯”è¾ƒæ¬¡æ•°ã€‚**

å¯¹å°è§„æ¨¡æ•°æ®é›†è€Œè¨€ï¼Œè¿™ç§ä¼˜åŒ–å°¤å…¶æœ‰æ•ˆï¼Œèƒ½æ˜¾è‘—æå‡æ’åºçš„æ•ˆç‡ã€‚

![åŠ¨å›¾ äºŒåˆ†æŸ¥æ‰¾æ’å…¥ä½ç½®](/doc/illustrations/timsort/Timsort03.gif)

ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ä½¿ç”¨ä¼ ç»Ÿæ’å…¥æ’åºæ—¶ï¼Œä¸ºå°†å…ƒç´  `2` æ’å…¥æ­£ç¡®ä½ç½®ï¼Œéœ€è¦è¿›è¡Œ 5 æ¬¡æ¯”è¾ƒã€‚è€Œåœ¨äºŒåˆ†æ’å…¥æ’åºä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹å¯ä»¥ç¼©å‡è‡³ä»…éœ€ 2 æ¬¡æ¯”è¾ƒï¼Œä»è€Œæ˜¾è‘—æé«˜æ’åºæ•ˆç‡ã€‚


## ğŸŒŸTimsort çš„å·¥ä½œåŸç† ##

åœ¨è¯¦ç»†äº†è§£äº†æ’å…¥æ’åºåœ¨ Timsort ä¸­çš„ä½œç”¨ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥äº†è§£å½’å¹¶æ’åºåœ¨ Timsort ä¸­çš„åº”ç”¨ã€‚ä¸è¿‡åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Timsort çš„æ•´ä½“å·¥ä½œåŸç†ã€‚

Timsort çš„è®¾è®¡ç›®æ ‡æ˜¯æœ€å¤§é™åº¦åœ°åˆ©ç”¨åœ¨ç»å¤§å¤šæ•°å®é™…æ•°æ®ä¸­å·²ç»å­˜åœ¨çš„è¿ç»­æœ‰åºåºåˆ—ï¼Œè¿™äº›è¢«ç§°ä¸ºè‡ªç„¶åºåˆ— natural runã€‚

åœ¨ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒéå†æ•°æ®é›†ï¼Œå€ŸåŠ©äºè¿™äº›è‡ªç„¶åºåˆ—ï¼Œå¿…è¦æ—¶å°†é™„è¿‘çš„å…ƒç´ æ·»åŠ è¿›å»ï¼Œå½¢æˆä¸€ä¸ªä¸ªçš„æ•°æ®å— runï¼Œå…¶ä¸­æ¯ä¸ª run ä¸­çš„å…ƒç´ éƒ½ä¼šè¿›è¡Œæ’åºã€‚

éšåï¼Œè¿™äº›æœ‰åºçš„ run è¢«å †å åœ¨ä¸€ä¸ªæ ˆä¸­ï¼Œå½¢æˆäº†ç®—æ³•å¤„ç†è¿‡ç¨‹çš„ä¸€ä¸ªå…³é”®ç»“æ„ã€‚

![åŠ¨å›¾ run å †å ](/doc/illustrations/timsort/Timsort04.gif)

å½“ä¸€ä¸ªæ–°çš„ run è¢«è¯†åˆ«å¹¶åŠ å…¥åˆ°æ ˆä¸­åï¼ŒTimsort ä¼šæ ¹æ®æ ˆé¡¶å¤šä¸ª run çš„é•¿åº¦æ¥åˆ¤æ–­ï¼Œæ˜¯å¦åº”è¯¥åˆå¹¶æ ˆé¡¶é™„è¿‘çš„ runã€‚

è¿™ä¸ªè¿‡ç¨‹å°†æŒç»­è¿›è¡Œï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½éå†å®Œã€‚

![run åˆå¹¶](/doc/illustrations/timsort/Timsort05.png)

éå†ç»“æŸåï¼Œæ ˆä¸­å‰©ä½™çš„æ‰€æœ‰ run æ¯æ¬¡ä¸¤ä¸¤åˆå¹¶ï¼Œç›´åˆ°æœ€ç»ˆå½¢æˆä¸€ä¸ªå®Œæ•´æœ‰åºçš„ runã€‚

ç›¸æ¯”ä¼ ç»Ÿå½’å¹¶æ’åºï¼Œåˆå¹¶é¢„æ’åºçš„ run ä¼šå¤§å¤§å‡å°‘äº†æ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°ï¼Œä»è€Œæå‡äº†æ•´ä½“çš„æ’åºæ•ˆç‡ã€‚

ç°åœ¨ï¼Œä½ å¯èƒ½å¯¹ Timsort ç®—æ³•çš„ç»†èŠ‚äº§ç”Ÿäº†è®¸å¤šç–‘é—®ã€‚run æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Ÿè¿™äº› run æ˜¯å¦‚ä½•åˆ©ç”¨æ•°æ®ä¸­å·²å­˜åœ¨çš„è‡ªç„¶åºåˆ—ï¼Ÿå½“ run è¢«åŠ å…¥åˆ°æ ˆä¸­åï¼Œä¾æ®ä»€ä¹ˆè§„åˆ™æ¥å†³å®šæ˜¯å¦åˆå¹¶ï¼Ÿâ€¦â€¦

ä¸ç”¨æ‹…å¿ƒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†é€ä¸€è§£ç­”è¿™äº›é—®é¢˜ï¼Œå¸¦ä½ æ›´æ·±å…¥åœ°ç†è§£ Timsort ç®—æ³•ã€‚


## ğŸ§®è®¡ç®— minrun ##

åœ¨ Timsort ç®—æ³•ä¸­ï¼Œrun çš„ç”Ÿæˆéå¸¸å…³é”®ï¼Œè€Œè¿™ä¸€è¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯ç¡®å®š run æœ€å°é•¿åº¦ minrunã€‚è¿™ä¸ªé•¿åº¦çš„è®¾å®šæ˜¯ä¸ºäº†åœ¨æ’åºè¿‡ç¨‹ä¸­è¾¾åˆ°ä¸¤ä¸ªå…³é”®ç›®æ ‡ï¼š

- ç¡®ä¿ run è¶³å¤Ÿé•¿ï¼Œä»¥ä¾¿æœ‰æ•ˆåœ°åˆ©ç”¨å½’å¹¶æ’åºï¼›
- é¿å… run è¿‡äºé•¿ï¼Œä»è€Œåœ¨åˆå¹¶æ—¶ä»èƒ½ä¿æŒé«˜æ•ˆã€‚

å®éªŒç ”ç©¶è¡¨æ˜ï¼Œå½“ minrun å°äº 8 æ—¶ï¼Œç¬¬ä¸€æ¡åŸåˆ™éš¾ä»¥æ»¡è¶³ï¼›è€Œå½“ minrun è¶…è¿‡ 256 æ—¶ï¼Œç¬¬äºŒæ¡åŸåˆ™å—åˆ°å½±å“ã€‚

å› æ­¤ï¼Œæœ€ä½³çš„ minrun é•¿åº¦èŒƒå›´è¢«ç¡®å®šåœ¨ 32 åˆ° 64 ä¹‹é—´ã€‚

*è¿™ä¸ªèŒƒå›´ä¸æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æ’å…¥æ’åºä¸­å°è§„æ¨¡æ•°æ®é›†çš„é•¿åº¦èŒƒå›´éå¸¸æ¥è¿‘ï¼Œè¿™å¹¶éå·§åˆã€‚äº‹å®ä¸Šï¼ŒTimsort åœ¨ç”Ÿæˆ run æ—¶ä¹Ÿä¼šåˆ©ç”¨åˆ°æ’å…¥æ’åºã€‚*

å…·ä½“è®¡ç®— minrun çš„æ–¹æ³•å¦‚ä¸‹ï¼š

1. **ç›®æ ‡**ï¼šé€‰å–ä¸€ä¸ª minrun å€¼ï¼Œä»¥ä½¿é•¿åº¦ä¸º n çš„æ•°ç»„è¢«åˆ†å‰²æˆçº¦ `n/minrun` ä¸ª runsï¼Œæ¯ä¸ª run åŒ…å«å¤§çº¦ 32 åˆ° 64 ä¸ªå…ƒç´ ã€‚

2. **è®¡ç®—æ–¹æ³•**ï¼šé€‰æ‹©æœ€æ¥è¿‘ `n/(2^k)` çš„ minrun å€¼ï¼Œè¿™é‡Œ k æ˜¯ä½¿ `n/(2^k)` è½åœ¨32è‡³64ä¹‹é—´çš„æœ€å¤§æ•´æ•°ã€‚ç„¶åè®¾ç½® minrun ä¸º `n/(2^k)`ã€‚

ä¾‹å¦‚ï¼Œå¯¹äºé•¿åº¦ä¸º 65 çš„æ•°ç»„ï¼Œminrun å°†è®¾ç½®ä¸º33ï¼Œå½¢æˆ 2 ä¸ªrunsï¼›å¯¹äºé•¿åº¦ä¸º 165 çš„æ•°ç»„ï¼Œminrun è®¾ç½®ä¸º42ï¼Œå½¢æˆ 4 ä¸ªrunsã€‚

è¿™ä¸ªè®¡ç®—è¿‡ç¨‹æ¶‰åŠåˆ° `(2^k)`ï¼Œå¯ä»¥é€šè¿‡ä½ç§»æ“ä½œé«˜æ•ˆå®ç°ï¼š

```python
def get_minrun(n):
    # ç”¨äºè®°å½•åœ¨ä¸æ–­å³ç§»è¿‡ç¨‹ä¸­ï¼Œnçš„æœ€ä½ä½ä¸Šéé›¶ä½çš„æ•°é‡
    r = 0
    while n >= 64:
        # æ£€æŸ¥nçš„æœ€ä½ä½æ˜¯å¦ä¸º1ï¼Œè‹¥æ˜¯ï¼Œåˆ™è®¾ç½®rä¸º1
        r |= n & 1
        # å‘å³ç§»åŠ¨ä¸€ä½ï¼Œç›¸å½“äºné™¤ä»¥2
        n >>= 1
    # è¿”å›nåŠ ä¸Šrï¼Œnæ˜¯åŸå§‹å€¼çš„æœ€é«˜6ä½ï¼Œræ˜¯è¡¨ç¤ºè¿‡ç¨‹ä¸­næ˜¯å¦æœ‰éé›¶æœ€ä½ä½çš„æ ‡å¿—
    return n + r
```

è¿™ç§æ–¹æ³•ä¸ä»…ä¿è¯äº† minrun çš„æœ‰æ•ˆæ€§ï¼Œè€Œä¸”åˆ©ç”¨äº†ä½è¿ç®—çš„é«˜æ•ˆæ€§ï¼Œä½“ç°äº† Timsort è®¾è®¡çš„å·§æ€ã€‚


## ğŸš€run çš„ç”Ÿæˆè¿‡ç¨‹

åœ¨æŒæ¡äº† minrun çš„è®¡ç®—æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¢ç©¶ run æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚

Timsort çš„æ ¸å¿ƒç›®æ ‡æ˜¯å……åˆ†åˆ©ç”¨æ•°æ®ä¸­å·²å­˜åœ¨çš„è¿ç»­æœ‰åºåºåˆ—æ¥ç”Ÿæˆ runï¼Œä½†è¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ

Timsort çš„å¤„ç†æµç¨‹å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š

1. Timsort å¼€å§‹æ‰«ææ•´ä¸ªæ•°ç»„ï¼Œå¯»æ‰¾è¿ç»­çš„å‡åºæˆ–é™åºåºåˆ—ã€‚
2. å¦‚æœé‡åˆ°å‡åºéƒ¨åˆ†ï¼ŒTimsort ä¼šæŒç»­æ‰«æç›´åˆ°å‡åºç»“æŸã€‚
3. å¦‚æœé‡åˆ°é™åºéƒ¨åˆ†ï¼ŒTimsort ä¼šç»§ç»­æ‰«æç›´åˆ°é™åºç»“æŸï¼Œå¹¶éšåå°†è¿™éƒ¨åˆ†ç¿»è½¬æˆå‡åºã€‚

**å¦‚æœä¸Šè¿°æ­¥éª¤è¯†åˆ«çš„ run æœªè¾¾åˆ° minrun é•¿åº¦**ï¼ŒTimsort ä¼šç»§ç»­æ‰©å±•è¿™ä¸ª runï¼Œå‘æ•°ç»„åæ–¹éå†ï¼Œçº³å…¥æ›´å¤šå…ƒç´ ï¼Œç›´è‡³è¾¾ minrun é•¿åº¦ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ–°åŠ å…¥å…ƒç´ çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚

ä¸€æ—¦æ‰©å±•å®Œæˆï¼Œè¿™ä¸ªæ‰©å±•åçš„ runï¼ˆæ— è®ºå…¶æœ€åˆæ˜¯å¦æœ‰åºï¼‰éƒ½å°†é€šè¿‡æ’å…¥æ’åºè¿›è¡Œæ’åºï¼Œä»¥ç¡®ä¿å…¶å†…éƒ¨æœ‰åºã€‚

**å¦‚æœè¯†åˆ«çš„ run é•¿åº¦è¿œè¶… minrun**ï¼Œå¯¹äºè¿™äº›è¾ƒé•¿çš„è¿ç»­æœ‰åºåºåˆ—ï¼ŒTimsort ä¼šä¿æŒå…¶åŸå§‹é•¿åº¦ï¼Œä¸è¿›è¡Œåˆ‡å‰²ã€‚è¿™æ˜¯å› ä¸ºè¾ƒé•¿çš„æœ‰åºåºåˆ—å¯¹äºå‡å°‘åç»­åˆå¹¶æ“ä½œçš„å¤æ‚åº¦éå¸¸æœ‰åˆ©ã€‚

å¯¹äºè¿™äº›è¶…é•¿çš„ runï¼Œé€šå¸¸æ— éœ€è¿›è¡Œé¢å¤–æ’åºï¼Œé™¤éå®ƒä»¬æ˜¯é™åºï¼Œè¿™æ—¶ Timsort ä¼šå…ˆå°†å…¶ç¿»è½¬æˆå‡åºã€‚

é€šè¿‡è¿™äº›ç­–ç•¥ï¼ŒTimsort èƒ½å¤Ÿé«˜æ•ˆåœ°ç”Ÿæˆä¸€ä¸ªæœ‰åºçš„ã€é•¿åº¦è‡³å°‘ä¸º minrun çš„ runï¼Œä¸ºåç»­çš„å½’å¹¶æ’åºè¿‡ç¨‹å¥ å®šäº†åšå®åŸºç¡€ã€‚


## ğŸ’¾æ ˆä¸­ run çš„åˆå¹¶è§„åˆ™ ##

åœ¨ Timsort ç®—æ³•ä¸­ï¼Œæ¯ç”Ÿæˆä¸€ä¸ªæ–°çš„ runï¼Œå®ƒå°±ä¼šè¢«åŠ å…¥åˆ°ä¸€ä¸ªä¸“é—¨çš„æ ˆä¸­ã€‚

è¿™æ—¶ï¼ŒTimsort ä¼šå¯¹æ ˆé¡¶çš„ä¸‰ä¸ª runï¼ˆæˆ‘ä»¬ç§°å®ƒä»¬ä¸ºXã€Yå’ŒZï¼‰è¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®ä¿å®ƒä»¬ç¬¦åˆç‰¹å®šçš„åˆå¹¶è§„åˆ™ï¼š

1. |Z| > |Y| + |X|
2. |Y| > |X|

å¦‚æœè¿™äº›æ¡ä»¶æ²¡æœ‰è¢«æ»¡è¶³ï¼ŒY å°±ä¼šä¸ X æˆ– Z ä¸­è¾ƒå°çš„ä¸€ä¸ªåˆå¹¶ï¼Œå¹¶é‡æ–°æ£€æŸ¥ä¸Šè¿°æ¡ä»¶ã€‚å½“æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œå¯ä»¥åœ¨æ•°æ®ä¸­ç»§ç»­éå†ç”Ÿæˆæ–°çš„ runã€‚

![run åˆå¹¶](/doc/illustrations/timsort/Timsort05.png)

è¿™ç§ç‹¬ç‰¹çš„åˆå¹¶è§„åˆ™æ˜¯ä¸ºäº†å®ç°ä»€ä¹ˆç›®æ ‡å‘¢ï¼Ÿ

åœ¨ Timsort çš„åˆå¹¶è§„åˆ™ä¸‹ï¼Œæœ€ç»ˆä¿ç•™åœ¨æ ˆä¸­çš„æ¯ä¸ª run çš„é•¿åº¦è‡³å°‘ç­‰äºå‰ä¸¤ä¸ª run çš„æ€»é•¿åº¦ï¼ˆç”±äºæ»¡è¶³`|Z| > |Y| + |X|` å’Œ `|Y| > |X|`çš„è§„åˆ™ï¼‰ã€‚

è¿™ç§è®¾è®¡æ„å‘³ç€ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ ˆä¸­ run çš„é•¿åº¦ä¼šé€æ¸å¢å¤§ï¼Œå…¶å¢é•¿æ–¹å¼ç±»ä¼¼äºæ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚

è¿™ç§å¢é•¿æ¨¡å¼çš„ä¸€ä¸ªé‡è¦ä¼˜åŠ¿åœ¨äºï¼Œå®ƒæä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ¥å¹³è¡¡æ•°æ®éå†å®Œæˆä¹‹å run çš„åˆå¹¶æ“ä½œï¼ŒåŒæ—¶é¿å…äº†è¿‡äºé¢‘ç¹çš„åˆå¹¶ã€‚

åœ¨æœ€ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ ˆä»é¡¶éƒ¨åˆ°åº•éƒ¨ run çš„é•¿åº¦åº”è¯¥æ˜¯[2,2,4,8,16,32,64,...]ã€‚è¿™æ ·ï¼Œä»æ ˆé¡¶åˆ°æ ˆåº•çš„åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡åˆå¹¶çš„ä¸¤ä¸ª run çš„é•¿åº¦éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œå½¢æˆäº†å®Œç¾çš„åˆå¹¶ã€‚

![æ ˆä¸­ run æœ€ç†æƒ³å½¢æ€](/doc/illustrations/timsort/Timsort06.png)

é€šè¿‡è¿™äº›å·§å¦™çš„è§„åˆ™ï¼ŒTimsort åœ¨ä¿è¯åˆå¹¶æ“ä½œè¿‘ä¼¼å‡è¡¡çš„åŒæ—¶ï¼Œä¹Ÿç¡®ä¿äº†åœ¨è¿½æ±‚å‡è¡¡å’Œç®€åŒ–åˆå¹¶å†³ç­–ä¹‹é—´çš„æƒè¡¡ã€‚

æ­£å¦‚ Tim Peters æ‰€æŒ‡å‡ºçš„ï¼Œæ‰¾åˆ°ä¸€ç§æ–¹å¼æ¥ç»´æŒæ ˆä¸­è¿™ä¸¤ä¸ªè§„åˆ™ï¼Œæ˜¯ä¸€ä¸ªæå…·æ™ºæ…§çš„æŠ˜ä¸­é€‰æ‹©ã€‚

## ğŸ“šåˆå¹¶è¿‡ç¨‹ä¸­çš„ç©ºé—´å¼€é”€

äº†è§£å®Œ Timsort çš„å·¥ä½œåŸç†å’Œ run åœ¨æ ˆä¸­çš„åˆå¹¶è§„åˆ™ä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨æ¥çœ‹ Timsort ä¸­çš„æœ€åä¸€ä¸ªé‡è¦ç¯èŠ‚ï¼šå¦‚ä½•é«˜æ•ˆåœ°è¿ç”¨å½’å¹¶æ’åºï¼Ÿ

è™½ç„¶ä¼ ç»Ÿçš„å½’å¹¶æ’åºä¹Ÿæ‹¥æœ‰ `O(nlogn)` çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†å®ƒå¹¶ä¸æ˜¯åŸåœ°æ’åºï¼Œå¹¶ä¸”éœ€è¦é¢å¤–çš„ `O(n)` ç©ºé—´å¼€é”€ï¼Œè¿™ä½¿å¾—å®ƒå¹¶æ²¡æœ‰è¢«å¹¿æ³›åœ°è¿ç”¨ã€‚

å½“ç„¶ï¼Œä¹Ÿæœ‰æ”¹è‰¯è¿‡çš„åŸåœ°å½’å¹¶æ’åºçš„å®ç°ï¼Œä½†å®ƒä»¬çš„æ—¶é—´å¼€é”€å°±ä¼šæ¯”è¾ƒå¤§ã€‚ä¸ºäº†åœ¨æ•ˆç‡å’Œç©ºé—´èŠ‚çº¦ä¹‹é—´å–å¾—å¹³è¡¡ï¼ŒTimsort é‡‡ç”¨äº†ä¸€ç§æ”¹è¿›çš„å½’å¹¶æ’åºï¼Œå…¶ç©ºé—´å¼€é”€è¿œå°äº`O(n)`ã€‚

ä»¥ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥è¯´æ˜ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå·²æ’åºçš„æ•°ç»„ `[1, 2, 3, 6, 10] ` å’Œ `[4, 5, 7, 9, 12, 14, 17]`ï¼Œç›®æ ‡æ˜¯å°†å®ƒä»¬åˆå¹¶ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼š
- ç¬¬äºŒä¸ªæ•°ç»„ä¸­çš„æœ€å°å…ƒç´ ï¼ˆ4ï¼‰éœ€è¦æ’å…¥åˆ°ç¬¬ä¸€ä¸ªæ•°ç»„çš„ç¬¬å››ä¸ªä½ç½®ä»¥ä¿æŒæ•´ä½“é¡ºåºï¼Œ
- ç¬¬ä¸€ä¸ªæ•°ç»„ä¸­çš„æœ€å¤§å…ƒç´ ï¼ˆ10ï¼‰éœ€è¦æ’å…¥åˆ°ç¬¬äºŒä¸ªæ•°ç»„çš„ç¬¬äº”ä¸ªä½ç½®ã€‚

å› æ­¤ï¼Œä¸¤ä¸ªæ•°ç»„ä¸­çš„ `[1, 2, 3]` å’Œ `[12, 14, 17]` å·²ç»ä½äºå®ƒä»¬çš„æœ€ç»ˆä½ç½®ï¼Œæ— éœ€ç§»åŠ¨ã€‚æˆ‘ä»¬å®é™…ä¸Šéœ€è¦åˆå¹¶çš„éƒ¨åˆ†æ˜¯ `[6, 10]` å’Œ `[4, 5, 7, 9]`ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 2 çš„ä¸´æ—¶æ•°ç»„ï¼Œå°†`[6, 10]`å¤åˆ¶åˆ°å…¶ä¸­ï¼Œç„¶ååœ¨åŸæ•°ç»„ä¸­å°†å®ƒä»¬ä¸`[4, 5, 7, 9]`åˆå¹¶ã€‚

![åŠ¨å›¾ å½’å¹¶æ’åº ä¼˜åŒ–åˆå¹¶è¿‡ç¨‹](/doc/illustrations/timsort/Timsort07.gif)

è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä»å‰å¾€åçš„åˆå¹¶è¿‡ç¨‹ã€‚åŒæ ·ï¼Œè¿˜æœ‰ä»åå¾€å‰åˆå¹¶çš„æƒ…å†µï¼š

![åŠ¨æ€å›¾ å½’å¹¶æ’åº ä»åå¾€å‰åˆå¹¶](/doc/illustrations/timsort/Timsort08.gif)

ä¸ä¼ ç»Ÿå½’å¹¶æ’åºç›¸æ¯”ï¼ŒTimsort åœ¨è¿™é‡Œé‡‡ç”¨çš„ä¼˜åŒ–ç­–ç•¥æ˜¾è‘—å‡å°‘äº†å…ƒç´ ç§»åŠ¨çš„æ¬¡æ•°ï¼Œç¼©çŸ­äº†è¿è¡Œæ—¶é—´ï¼Œå¹¶å¤§å¹…é™ä½äº†ä¸´æ—¶ç©ºé—´çš„éœ€æ±‚ã€‚


## âš¡åˆå¹¶è¿‡ç¨‹ä¸­çš„ galloping mode ##

åœ¨å½’å¹¶æ’åºè¿‡ç¨‹ä¸­ï¼Œé€šå¸¸çš„åšæ³•æ˜¯é€ä¸ªæ¯”è¾ƒä¸¤ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¹¶å°†è¾ƒå°çš„å…ƒç´ ä¾æ¬¡æ”¾ç½®åˆ°åˆé€‚çš„ä½ç½®ã€‚

ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½æ¶‰åŠå¤§é‡å†—ä½™çš„æ¯”è¾ƒæ“ä½œï¼Œå°¤å…¶æ˜¯å½“ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ è¿ç»­åœ°èƒœå‡ºå¦ä¸€ä¸ªæ•°ç»„æ—¶ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªæç«¯ä¸å¹³è¡¡çš„æ•°ç»„ï¼š

A = [1, 2, 3, â€¦, 9999, 10000]

B = [20000, 20001, â€¦, 29999, 30000]

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†ç¡®å®š B ä¸­å…ƒç´ çš„æ­£ç¡®æ’å…¥ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œé«˜è¾¾ 10000 æ¬¡çš„æ¯”è¾ƒï¼Œè¿™æ— ç–‘æ˜¯ä½æ•ˆçš„ã€‚

å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

Timsort çš„è§£å†³æ–¹æ¡ˆæ˜¯å¼•å…¥äº†æ‰€è°“çš„â€œè·ƒè¿›æ¨¡å¼â€ï¼ˆgalloping modeï¼‰ã€‚è¿™ç§æ¨¡å¼åŸºäºä¸€ä¸ªå‡è®¾ï¼šå¦‚æœä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ è¿ç»­èƒœå‡ºå¦ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ç§è¶‹åŠ¿å¯èƒ½ä¼šæŒç»­ä¸‹å»ã€‚

Timsort ä¼šç»Ÿè®¡ä»ä¸€ä¸ªæ•°ç»„è¿ç»­é€‰ä¸­çš„å…ƒç´ æ•°é‡ï¼Œä¸€æ—¦è¿ç»­èƒœå‡ºæ¬¡æ•°è¾¾åˆ°äº†ç§°ä¸º min_gallop çš„é˜ˆå€¼æ—¶ï¼ŒTimsort å°±ä¼šåˆ‡æ¢åˆ°è·ƒè¿›æ¨¡å¼ã€‚

åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç®—æ³•å°†ä¸å†é€ä¸ªæ¯”è¾ƒå…ƒç´ ï¼Œè€Œæ˜¯å°†å®æ–½ä¸€ç§æŒ‡æ•°çº§æœç´¢ï¼ˆexponential searchï¼‰ã€‚ä»¥æŒ‡æ•°çº§çš„æ­¥é•¿ï¼ˆ2^kï¼‰è¿›è¡Œè·³è·ƒï¼Œé¦–å…ˆæ£€æŸ¥ä½ç½® 1 çš„å…ƒç´ ï¼Œç„¶åæ˜¯ä½ç½® 3 (1 + 2^1 )ï¼Œæ¥ç€æ˜¯ä½ç½® 7 (3 + 2^2)ï¼Œä»¥æ­¤ç±»æ¨ã€‚

å½“é¦–æ¬¡æ‰¾åˆ°å¤§äºæˆ–ç­‰äºæ¯”è¾ƒå…ƒç´ çš„ä½ç½®æ—¶ï¼Œæˆ‘ä»¬å°±å°†æœç´¢èŒƒå›´ç¼©å°åˆ°ä¸Šä¸€æ­¥çš„ä½ç½®ï¼ˆ2^(k-1) + 1ï¼‰å’Œå½“å‰æ­¥çš„ä½ç½®ï¼ˆ2^k + 1ï¼‰ä¹‹é—´çš„åŒºé—´ã€‚

åœ¨è¿™ä¸ªåŒºé—´å†…è¿›è¡Œæ›´äºŒåˆ†æœç´¢ï¼Œä»¥å¿«é€Ÿå®šä½æ­£ç¡®çš„æ’å…¥ä½ç½®ã€‚

æ®å¼€å‘è€…çš„åŸºå‡†æµ‹è¯•ï¼Œåªæœ‰å½“ä¸€ä¸ªæ•°ç»„çš„é¦–å…ƒç´ å¹¶ä¸å¤„äºå¦ä¸€æ•°ç»„çš„å‰ 7 ä½ç½®æ—¶ï¼Œè·ƒè¿›æ¨¡å¼æ‰çœŸæ­£å¸¦æ¥ä¼˜åŠ¿ï¼Œå› æ­¤ min_gallop çš„é˜ˆå€¼ä¸º 7ã€‚

ä¸Šé¢çš„æ­¥éª¤çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ä»¥ä¸¤ä¸ªæ•°ç»„ä¸ºä¾‹ï¼š

A = [1, 25, 31, 37]

B = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36]

æ ¹æ®ä¹‹å‰åˆå¹¶è¿‡ç¨‹ä¸­çš„ç©ºé—´å¼€é”€åŸåˆ™ï¼ŒA ä¸­çš„å…ƒç´  `1` æ˜¯å›ºå®šçš„ï¼Œæ­¤æ—¶å°†`25, 31, 37` ç§»åŠ¨åˆ°ä¸´æ—¶ç©ºé—´è¿›è¡Œåˆå¹¶æ’åºã€‚

![åŠ¨å›¾ è·ƒè¿›æ¨¡å¼ 1](/doc/illustrations/timsort/Timsort10.gif)

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ `25` åœ¨ä¸ B æ•°ç»„å…ƒç´ æ¯”è¾ƒæ—¶è¿ç»­èƒœå‡ºï¼Œè§¦å‘äº†è·ƒè¿›æ¨¡å¼ã€‚

![åŠ¨å›¾ è·ƒè¿›æ¨¡å¼ 2](/doc/illustrations/timsort/Timsort11.gif)

ç®—æ³•ç›´æ¥è·³è·ƒåˆ°ä½ç½® 15 (7 + 2^3)ï¼Œå‘ç° `30` å¤§äº `25`ã€‚

![åŠ¨å›¾ è·ƒè¿›æ¨¡å¼ 3](/doc/illustrations/timsort/Timsort12.gif)


è¿›è€Œåœ¨ä½ç½® 7 å’Œ 15 ä¹‹é—´æ‰§è¡ŒäºŒåˆ†æœç´¢ï¼Œä»¥æ‰¾åˆ° `25` çš„æ’å…¥ç‚¹ã€‚

![åŠ¨å›¾ è·ƒè¿›æ¨¡å¼ 4](/doc/illustrations/timsort/Timsort13.gif)

è™½ç„¶è·ƒè¿›æ¨¡å¼åœ¨æŸäº›æƒ…å†µä¸‹èƒ½æå¤§æé«˜æ•ˆç‡ï¼Œä½†å®ƒå¹¶éæ€»æ˜¯æœ€ä¼˜é€‰æ‹©ã€‚æœ‰æ—¶ï¼Œè·ƒè¿›æ¨¡å¼å¯èƒ½å¯¼è‡´æ›´å¤šçš„æ¯”è¾ƒæ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®åˆ†å¸ƒè¾ƒä¸ºå‡åŒ€æ—¶ã€‚

ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒTimsorté‡‡ç”¨äº†ä¸¤ç§ç­–ç•¥ï¼šä¸€æ˜¯å½“è¯†åˆ«åˆ°è·ƒè¿›æ¨¡å¼çš„æ•ˆç‡ä¸åŠäºŒåˆ†æœç´¢æ—¶ï¼Œä¼šé€€å‡ºè·ƒè¿›æ¨¡å¼ï¼›äºŒæ˜¯æ ¹æ®è·ƒè¿›æ¨¡å¼çš„æˆåŠŸä¸å¦è°ƒæ•´ min_gallop å€¼ã€‚

å¦‚æœè·ƒè¿›æ¨¡å¼æˆåŠŸä¸”è¿ç»­é€‰æ‹©çš„å…ƒç´ å‡æ¥è‡ªåŒä¸€æ•°ç»„ï¼Œmin_gallop å€¼ä¼šå‡ 1ï¼Œä»¥é¼“åŠ±å†æ¬¡ä½¿ç”¨è·ƒè¿›æ¨¡å¼ï¼›åä¹‹ï¼Œåˆ™åŠ  1ï¼Œå‡å°‘å†æ¬¡ä½¿ç”¨è·ƒè¿›æ¨¡å¼çš„å¯èƒ½æ€§ã€‚

## ğŸ’¡ç»“è¯­ï¼šTimsort - æ•°æ®æ’åºçš„å®ç”¨é©æ–° ##

åœ¨æ¢ç´¢æ•°æ®æ’åºè¿™ä¸ªå†å²æ‚ ä¹…ä¸”å……æ»¡æŒ‘æˆ˜çš„é¢†åŸŸä¸­ï¼ŒTimsort ç®—æ³•ä¸ä»…æ˜¯ä¸€é¡¹æŠ€æœ¯æˆå°±ï¼Œæ›´æ˜¯å®ç”¨æ€§ä¸åˆ›æ–°çš„æ°å‡ºå…¸èŒƒã€‚å®ƒçš„å‡ºç°ï¼Œä¸å•å•æ˜¯ç®—æ³•é¢†åŸŸçš„ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œæ›´æ˜¯å¯¹ç°å®ä¸–ç•Œå¤æ‚æ•°æ®å¤„ç†éœ€æ±‚çš„æœ‰æ•ˆå›åº”ã€‚

Timsort çš„çœŸæ­£é­…åŠ›ä¸ä»…åœ¨äºå®ƒçš„é«˜æ•ˆç‡ï¼Œæ›´åœ¨äºå®ƒå¯¹å®é™…æ•°æ®ç‰¹æ€§çš„æ·±å…¥ç†è§£å’Œåˆ©ç”¨ã€‚è¿™ä¸ªç®—æ³•ä¸æ˜¯é™æ€çš„ï¼Œå®ƒé€šè¿‡å¯¹æ•°æ®çš„è§‚å¯Ÿï¼ŒåŠ¨æ€è°ƒæ•´è‡ªèº«ç­–ç•¥ï¼Œä»¥é€‚åº”ä¸åŒçš„æ•°æ®æ¨¡å¼ã€‚

è¿™ç§è®¾è®¡æ€è·¯æä¾›äº†ä¸€ä¸ªé‡è¦çš„å¯ç¤ºï¼šåœ¨é¢å¯¹ç°å®ä¸–ç•Œé—®é¢˜æ—¶ï¼Œç†è®ºå’Œå®è·µçš„ç»“åˆå¾€å¾€æ¯”å•çº¯è¿½æ±‚ç†è®ºå®Œç¾æ›´ä¸ºé‡è¦ã€‚

é€šè¿‡æœ¬æ–‡çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å¯¹ Timsort çš„å·¥ä½œåŸç†åŠå…¶æ ¸å¿ƒæ¦‚å¿µæœ‰äº†æ›´ä¸ºç›´è§‚çš„ç†è§£ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡å›é¡¾å®ƒåœ¨ç»´åŸºç™¾ç§‘ä¸Šçš„å®šä¹‰ï¼Œæ‚¨ä¼šå‘ç°è‡ªå·±æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†ã€‚

>Timsort çš„è®¾è®¡ç›®æ ‡æ˜¯æœ€å¤§é™åº¦åœ°åˆ©ç”¨åœ¨ç»å¤§å¤šæ•°å®é™…æ•°æ®ä¸­å·²ç»å­˜åœ¨çš„è¿ç»­æœ‰åºåºåˆ—ï¼Œè¿™äº›è¢«ç§°ä¸ºè‡ªç„¶åºåˆ— natural runã€‚åœ¨ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šéå†æ•°æ®ï¼Œå°†å…ƒç´ å½’ç±»åˆ° runï¼Œå¹¶å°†è¿™äº› run å †å èµ·æ¥ã€‚å½“å †æ ˆé¡¶éƒ¨çš„ run ç¬¦åˆæŸä¸ªåˆå¹¶æ¡ä»¶æ—¶ï¼Œå®ƒä»¬ä¼šè¢«åˆå¹¶ã€‚æ­¤è¿‡ç¨‹å°†æŒç»­è¿›è¡Œï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½éå†å®Œã€‚ç„¶åï¼Œæ‰€æœ‰çš„ run æ¯æ¬¡ä¸¤ä¸¤åˆå¹¶ï¼Œæœ€ç»ˆä»…ç•™ä¸‹ä¸€ä¸ªå®Œæ•´çš„æœ‰åº runã€‚ç›¸è¾ƒäºä¼ ç»Ÿçš„ mergesortï¼Œåˆå¹¶é¢„æ’åºçš„ run çš„å¥½å¤„æ˜¯å®ƒå¤§å¤§é™ä½äº†å®Œæˆæ•´ä½“æ’åºæ‰€éœ€çš„æ¯”è¾ƒæ¬¡æ•°ã€‚

---

å‚è€ƒèµ„æ–™ï¼š

 [1] https://en.wikipedia.org/wiki/Timsort

 [2] https://dev.to/brandonskerritt/timsort-the-fastest-sorting-algorithm-you-ve-never-heard-of-2ake

 [3] https://www.infopulse.com/blog/timsort-sorting-algorithm

 [4] https://juejin.cn/post/6844904131518267400

 [5] https://www.youtube.com/watch?v=_dlzWEJoU7I

 [6] https://www.youtube.com/watch?v=1wAOy88WxmY